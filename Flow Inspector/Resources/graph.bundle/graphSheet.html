<!DOCTYPE html>
<html>
    <head>
        <title>Flow Inspector Graph</title>
        <style>
            html, body { height: 100%; width: 100%; margin: 0;}
            #sheet {
                background: #3E9DDD;
                padding: 20px;
            }
        #drawing {
            background: #4CA3DF;
        }
        @media
        only screen and (-webkit-min-device-pixel-ratio : 1.5),
        only screen and (-o-min-device-pixel-ratio: 3/2),
        only screen and (min--moz-device-pixel-ratio: 1.5),
        only screen and (min-device-pixel-ratio: 1.5)
        only screen and (-webkit-min-device-pixel-ratio: 2),
        only screen and (min--moz-device-pixel-ratio: 2),
        only screen and (-o-min-device-pixel-ratio: 2/1),
        only screen and (min-device-pixel-ratio: 2),
        only screen and (-webkit-min-device-pixel-ratio: 2) {
            #drawing {
                background-image: url(background@2x.png);
                background-repeat: repeat;
                background-size: 50px; 50px;
            }

        </style>
        
        <script src="svg.js"></script>
        <script src="dagre.min.js"></script>
    </head>
    <body>
        <div id="sheet">
            <div id="drawing"></div>
        </div>
    </body>
    <script>

var json = "{\"nodes\":[{\"v\":\"fifo_queue_0\",\"value\":{\"label\":\"fifo_queue_0\",\"viewModelType\":\"operation\",\"width\":180,\"height\":30}},{\"v\":\"arg_tensor_enqueue_0\",\"value\":{\"label\":\"arg_tensor_enqueue_0\",\"viewModelType\":\"operation\",\"width\":300,\"height\":30}},{\"v\":\"fifo_queue_enqueue_0\",\"value\":{\"label\":\"fifo_queue_enqueue_0\",\"viewModelType\":\"operation\",\"width\":300,\"height\":30}},{\"v\":\"tfc_input_0_S7TFDebug19opsStridedSliceTest4last10TensorFlow0G0VySfGSf_tF.tf\",\"value\":{\"label\":\"tfc_input_0_S7TFDebug19opsStridedSliceTest4last10TensorFlow0G0VySfGSf_tF.tf\",\"viewModelType\":\"operation\",\"width\":375,\"height\":30}},{\"v\":\"tfc_func_S7TFDebug19opsStridedSliceTest4last10TensorFlow0G0VySfGSf_tF.tf\",\"value\":{\"label\":\"tfc_func_S7TFDebug19opsStridedSliceTest4last10TensorFlow0G0VySfGSf_tF.tf\",\"viewModelType\":\"operation\",\"width\":375,\"height\":30}},{\"v\":\"tfc_output_0_S7TFDebug19opsStridedSliceTest4last10TensorFlow0G0VySfGSf_tF.tf\",\"value\":{\"label\":\"tfc_output_0_S7TFDebug19opsStridedSliceTest4last10TensorFlow0G0VySfGSf_tF.tf\",\"viewModelType\":\"operation\",\"width\":375,\"height\":30}},{\"v\":\"op\\/opsStridedSliceTest.last_..12.6\",\"value\":{\"label\":\"op\\/opsStridedSliceTest.last_..12.6\",\"viewModelType\":\"libraryFunction\",\"width\":375,\"height\":30}},{\"v\":\"op\\/opsStridedSliceTest.last_._1.12.6\",\"value\":{\"label\":\"op\\/opsStridedSliceTest.last_._1.12.6\",\"viewModelType\":\"libraryFunction\",\"width\":375,\"height\":30}},{\"v\":\"fifo_queue_0\",\"value\":{\"label\":\"fifo_queue_0\",\"viewModelType\":\"libraryFunction\",\"width\":180,\"height\":30}},{\"v\":\"fifo_queue_dequeue_0\",\"value\":{\"label\":\"fifo_queue_dequeue_0\",\"viewModelType\":\"libraryFunction\",\"width\":300,\"height\":30}},{\"v\":\"op\\/opsStridedSliceTest.last_._2.12.6\",\"value\":{\"label\":\"op\\/opsStridedSliceTest.last_._2.12.6\",\"viewModelType\":\"libraryFunction\",\"width\":375,\"height\":30}},{\"v\":\"op\\/opsStridedSliceTest.last_._3.12.6\",\"value\":{\"label\":\"op\\/opsStridedSliceTest.last_._3.12.6\",\"viewModelType\":\"libraryFunction\",\"width\":375,\"height\":30}},{\"v\":\"op\\/opsStridedSliceTest.last_._4.12.6\",\"value\":{\"label\":\"op\\/opsStridedSliceTest.last_._4.12.6\",\"viewModelType\":\"libraryFunction\",\"width\":375,\"height\":30}},{\"v\":\"op\\/opsStridedSliceTest.last_._5.12.6\",\"value\":{\"label\":\"op\\/opsStridedSliceTest.last_._5.12.6\",\"viewModelType\":\"libraryFunction\",\"width\":375,\"height\":30}},{\"v\":\"op\\/opsStridedSliceTest.last_._6.12.6\",\"value\":{\"label\":\"op\\/opsStridedSliceTest.last_._6.12.6\",\"viewModelType\":\"libraryFunction\",\"width\":375,\"height\":30}},{\"v\":\"op\\/opsStridedSliceTest.last_._7.12.6\",\"value\":{\"label\":\"op\\/opsStridedSliceTest.last_._7.12.6\",\"viewModelType\":\"libraryFunction\",\"width\":375,\"height\":30}},{\"v\":\"op\\/opsStridedSliceTest.last_._8.12.6\",\"value\":{\"label\":\"op\\/opsStridedSliceTest.last_._8.12.6\",\"viewModelType\":\"libraryFunction\",\"width\":375,\"height\":30}},{\"v\":\"op\\/opsStridedSliceTest.last_._9.12.6\",\"value\":{\"label\":\"op\\/opsStridedSliceTest.last_._9.12.6\",\"viewModelType\":\"libraryFunction\",\"width\":375,\"height\":30}},{\"v\":\"op\\/opsStridedSliceTest.last_._10.12.6\",\"value\":{\"label\":\"op\\/opsStridedSliceTest.last_._10.12.6\",\"viewModelType\":\"libraryFunction\",\"width\":375,\"height\":30}},{\"v\":\"op\\/opsStridedSliceTest.last_._11.12.6\",\"value\":{\"label\":\"op\\/opsStridedSliceTest.last_._11.12.6\",\"viewModelType\":\"libraryFunction\",\"width\":375,\"height\":30}},{\"v\":\"op\\/opsStridedSliceTest.last_._12.12.6\",\"value\":{\"label\":\"op\\/opsStridedSliceTest.last_._12.12.6\",\"viewModelType\":\"libraryFunction\",\"width\":375,\"height\":30}},{\"v\":\"RunControlDependency\",\"value\":{\"label\":\"RunControlDependency\",\"viewModelType\":\"libraryFunction\",\"width\":300,\"height\":30}},{\"v\":\"arg_0\",\"value\":{\"label\":\"arg_0\",\"viewModelType\":\"arg\",\"width\":75,\"height\":30}}],\"edges\":[{\"v\":\"fifo_queue_enqueue_0\",\"w\":\"fifo_queue_0\",\"value\":{\"label\":\"fifo_queue_enqueue_0 <- fifo_queue_0\",\"viewModelType\":\"input\"}},{\"v\":\"fifo_queue_enqueue_0\",\"w\":\"arg_tensor_enqueue_0\",\"value\":{\"label\":\"fifo_queue_enqueue_0 <- arg_tensor_enqueue_0\",\"viewModelType\":\"input\"}},{\"v\":\"tfc_func_S7TFDebug19opsStridedSliceTest4last10TensorFlow0G0VySfGSf_tF.tf\",\"w\":\"tfc_input_0_S7TFDebug19opsStridedSliceTest4last10TensorFlow0G0VySfGSf_tF.tf\",\"value\":{\"label\":\"tfc_func_S7TFDebug19opsStridedSliceTest4last10TensorFlow0G0VySfGSf_tF.tf <- tfc_input_0_S7TFDebug19opsStridedSliceTest4last10TensorFlow0G0VySfGSf_tF.tf\",\"viewModelType\":\"input\"}},{\"v\":\"tfc_output_0_S7TFDebug19opsStridedSliceTest4last10TensorFlow0G0VySfGSf_tF.tf\",\"w\":\"tfc_func_S7TFDebug19opsStridedSliceTest4last10TensorFlow0G0VySfGSf_tF.tf\",\"value\":{\"label\":\"tfc_output_0_S7TFDebug19opsStridedSliceTest4last10TensorFlow0G0VySfGSf_tF.tf <- tfc_func_S7TFDebug19opsStridedSliceTest4last10TensorFlow0G0VySfGSf_tF.tf\",\"viewModelType\":\"input\"}},{\"v\":\"fifo_queue_dequeue_0\",\"w\":\"fifo_queue_0\",\"value\":{\"label\":\"fifo_queue_dequeue_0 <- fifo_queue_0\",\"viewModelType\":\"input\"}},{\"v\":\"op\\/opsStridedSliceTest.last_._3.12.6\",\"w\":\"arg_0\",\"value\":{\"label\":\"op\\/opsStridedSliceTest.last_._3.12.6 <- arg_0\",\"viewModelType\":\"input\"}},{\"v\":\"op\\/opsStridedSliceTest.last_._3.12.6\",\"w\":\"op\\/opsStridedSliceTest.last_._1.12.6\",\"value\":{\"label\":\"op\\/opsStridedSliceTest.last_._3.12.6 <- op\\/opsStridedSliceTest.last_._1.12.6\",\"viewModelType\":\"input\"}},{\"v\":\"op\\/opsStridedSliceTest.last_._3.12.6\",\"w\":\"fifo_queue_dequeue_0\",\"value\":{\"label\":\"op\\/opsStridedSliceTest.last_._3.12.6 <- fifo_queue_dequeue_0\",\"viewModelType\":\"input\"}},{\"v\":\"op\\/opsStridedSliceTest.last_._3.12.6\",\"w\":\"op\\/opsStridedSliceTest.last_._2.12.6\",\"value\":{\"label\":\"op\\/opsStridedSliceTest.last_._3.12.6 <- op\\/opsStridedSliceTest.last_._2.12.6\",\"viewModelType\":\"input\"}},{\"v\":\"op\\/opsStridedSliceTest.last_._6.12.6\",\"w\":\"op\\/opsStridedSliceTest.last_._5.12.6\",\"value\":{\"label\":\"op\\/opsStridedSliceTest.last_._6.12.6 <- op\\/opsStridedSliceTest.last_._5.12.6\",\"viewModelType\":\"input\"}},{\"v\":\"op\\/opsStridedSliceTest.last_._6.12.6\",\"w\":\"op\\/opsStridedSliceTest.last_._4.12.6\",\"value\":{\"label\":\"op\\/opsStridedSliceTest.last_._6.12.6 <- op\\/opsStridedSliceTest.last_._4.12.6\",\"viewModelType\":\"input\"}},{\"v\":\"op\\/opsStridedSliceTest.last_._7.12.6\",\"w\":\"op\\/opsStridedSliceTest.last_._3.12.6\",\"value\":{\"label\":\"op\\/opsStridedSliceTest.last_._7.12.6 <- op\\/opsStridedSliceTest.last_._3.12.6\",\"viewModelType\":\"input\"}},{\"v\":\"op\\/opsStridedSliceTest.last_._7.12.6\",\"w\":\"op\\/opsStridedSliceTest.last_._6.12.6\",\"value\":{\"label\":\"op\\/opsStridedSliceTest.last_._7.12.6 <- op\\/opsStridedSliceTest.last_._6.12.6\",\"viewModelType\":\"input\"}},{\"v\":\"op\\/opsStridedSliceTest.last_._8.12.6\",\"w\":\"op\\/opsStridedSliceTest.last_..12.6\",\"value\":{\"label\":\"op\\/opsStridedSliceTest.last_._8.12.6 <- op\\/opsStridedSliceTest.last_..12.6\",\"viewModelType\":\"input\"}},{\"v\":\"op\\/opsStridedSliceTest.last_._9.12.6\",\"w\":\"op\\/opsStridedSliceTest.last_._7.12.6\",\"value\":{\"label\":\"op\\/opsStridedSliceTest.last_._9.12.6 <- op\\/opsStridedSliceTest.last_._7.12.6\",\"viewModelType\":\"input\"}},{\"v\":\"op\\/opsStridedSliceTest.last_._10.12.6\",\"w\":\"op\\/opsStridedSliceTest.last_._9.12.6\",\"value\":{\"label\":\"op\\/opsStridedSliceTest.last_._10.12.6 <- op\\/opsStridedSliceTest.last_._9.12.6\",\"viewModelType\":\"input\"}},{\"v\":\"op\\/opsStridedSliceTest.last_._11.12.6\",\"w\":\"op\\/opsStridedSliceTest.last_._8.12.6\",\"value\":{\"label\":\"op\\/opsStridedSliceTest.last_._11.12.6 <- op\\/opsStridedSliceTest.last_._8.12.6\",\"viewModelType\":\"input\"}},{\"v\":\"op\\/opsStridedSliceTest.last_._11.12.6\",\"w\":\"op\\/opsStridedSliceTest.last_._10.12.6\",\"value\":{\"label\":\"op\\/opsStridedSliceTest.last_._11.12.6 <- op\\/opsStridedSliceTest.last_._10.12.6\",\"viewModelType\":\"input\"}},{\"v\":\"op\\/opsStridedSliceTest.last_._12.12.6\",\"w\":\"op\\/opsStridedSliceTest.last_._8.12.6\",\"value\":{\"label\":\"op\\/opsStridedSliceTest.last_._12.12.6 <- op\\/opsStridedSliceTest.last_._8.12.6\",\"viewModelType\":\"input\"}},{\"v\":\"op\\/opsStridedSliceTest.last_._12.12.6\",\"w\":\"op\\/opsStridedSliceTest.last_._11.12.6\",\"value\":{\"label\":\"op\\/opsStridedSliceTest.last_._12.12.6 <- op\\/opsStridedSliceTest.last_._11.12.6\",\"viewModelType\":\"input\"}},{\"v\":\"RunControlDependency\",\"w\":\"op\\/opsStridedSliceTest.last_._12.12.6\",\"value\":{\"label\":\"RunControlDependency <- op\\/opsStridedSliceTest.last_._12.12.6\",\"viewModelType\":\"input\"}},{\"v\":\"RunControlDependency\",\"w\":\"fifo_queue_dequeue_0\",\"value\":{\"label\":\"RunControlDependency <- ^fifo_queue_dequeue_0\",\"viewModelType\":\"controlDependencies\"}}],\"options\":{\"directed\":true,\"multigraph\":false,\"compound\":false}}"

<!--        drawGraph(json);-->
	 function loadContent(content) {
	      drawGraph(atob(content));
	 }
  
	 function drawGraph(json) {
	    	//Create a new directed graph
	  	var g = dagre.graphlib.json.read(JSON.parse(json));
	    	// Set an object for the graph label
	    	g.setGraph({"marginx": 10, "marginy": 10});

	    	// Default to assigning a new object as a label for each new edge.
	    	g.setDefaultEdgeLabel(function() { return {}; });
	    	dagre.layout(g);
	
	  	var sheetWidth = 1024
	  	var sheetHeight = 1024

	    	g.nodes().forEach(function(v) {
	  		var node = g.node(v);
            if (node == null){ return; }
                              
	  		var sW = node.x + node.width;
	  		var sH = node.y + node.height;
	  		if (sheetWidth < sW) {
	  			sheetWidth = sW;
	  		} 
	  		if (sheetHeight < sH) {
	  			sheetHeight = sH;
	  		}
	  	});

	  	var draw = SVG('drawing').size(sheetWidth, sheetHeight)

            document.getElementById("sheet").style.width = sheetWidth + "px";
            document.getElementById("sheet").style.height = sheetHeight + "px";
            document.getElementById("drawing").style.width = sheetWidth + "px";
            document.getElementById("drawing").style.height = sheetHeight + "px";

            g.nodes().forEach(function(identifier) {
                var node = g.node(identifier);
                if (node == null){ return; }
	  		    drawNode(node, identifier, draw)
	    	});
	
	    	g.edges().forEach(function(e) {
	  		    var edge = g.edge(e)
                if (edge == null){ return; }
	  		    drawEdge(edge, draw)
	    	});
	  }
	
	function drawEdge(edge, draw) {
        var strokeColor = '#fff'
        var viewModelType = edge.viewModelType
        if (viewModelType == 'controlDependencies') {
            strokeColor = '#3333aa'
        }
		var points = edge.points
		var polyline = draw.polyline(edge.points)
		polyline.attr({ fill: 'none', 'fill-opacity': 0.5, stroke: strokeColor, 'stroke-width': 1.5})
        polyline.marker('start', 14, 14, function(add) {
            add.polyline([[14, 5], [14, 9], [7, 7]])
            this.fill(strokeColor)
        })
	}
	
	function drawNode(node, identifier, draw) {
		var nodeWidth = node.width;
		var nodeHeight = node.height;
		var nodeX = node.x-nodeWidth/2;
		var nodeY = node.y-nodeHeight/2;
		var nodeCenterX = node.x;
		var nodeCenterY = node.y;
		var rect = draw.rect(nodeWidth, nodeHeight).move(nodeX, nodeY);
		
        var radius = 20;
        if (node.viewModelType == "operation") {
           radius = 10
        } if (node.viewModelType == "arg") {
            radius = 0
        }
        
        rect.radius(radius);
		addText(node.label, nodeX, nodeY, nodeWidth, nodeHeight, identifier, draw);
        rect.attr({'nodeIdentifier' : identifier});
        
 		 rect.attr({ fill: '#fff', 'fill-opacity': 0.2, stroke: '#fff', 'stroke-width': 1})
	 	 rect.click(function() {			 
			 this.animate(150).attr({ fill: '#fff', 'fill-opacity': 1.0 });
			 this.animate(150).attr({ fill: '#eee', 'fill-opacity': 0.2 });
			 didSelectNode(this.attr('nodeIdentifier'));
	 	 })
	}
	
	function addText(string, x, y, width, height, nodeIdentifier, draw) {
		var maxLength = 45;
		var fontSize = 14;
		
		var trimmedString = string.length > maxLength ? string.substring(0, maxLength - 3) + "..." :  string;
		var text = draw.text(function(add) {
			add.tspan(trimmedString).fill('#fff');
		})
		
		text.attr({'nodeIdentifier' : nodeIdentifier});
		
		text.click(function() {
			didSelectNode(this.attr('nodeIdentifier'));
		})
		
		text.font({ family: 'Helvetica', size: fontSize});
		var length = text.length();
		var margin = (width - length) / 2;
		var marginY = (height - fontSize) / 2;
		text.move(x + margin, y + marginY);	
	}

	function didSelectNode(identifier){
        var body = { nodeIdentifier: identifier };
        window.webkit.messageHandlers.onMouseDown.postMessage(body);
	}
    
  </script>
</html>
